{"version":3,"sources":["../../src/models/user.js"],"names":["user","sequelize","DataTypes","User","define","username","type","STRING","unique","allowNull","email","password","role","firstName","lastName","phoneNumber","completedProfile","BOOLEAN","associate","models","hasMany","Message","onDelete","findByLogin","login","findOne","where","beforeCreate","generatePasswordHash","beforeUpdate","prototype","saltRounds","bcrypt","hash","validatePassword","compare"],"mappings":"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","sourcesContent":["// Password hash crypto\nimport bcrypt from \"bcrypt\";\n\n// Define user with validation requirements\nconst user = (sequelize, DataTypes) => {\n  const User = sequelize.define(\"user\", {\n    username: {\n      type: DataTypes.STRING,\n      unique: true,\n      allowNull: false,\n      // validate: {\n      //   notEmpty: {\n      //     args: true,\n      //     msg: \"Username required.\",\n      //   },\n      //   len: {\n      //     args: [5, 20],\n      //     msg: \"Username length of 5-20 required.\",\n      //   },\n      // },\n    },\n    email: {\n      type: DataTypes.STRING,\n      unique: true,\n      allowNull: false,\n      // validate: {\n      //   notEmpty: true,\n      //   isEmail: true,\n      //   msg: \"Valid email is required\",\n      // },\n    },\n    password: {\n      type: DataTypes.STRING,\n      allowNull: false,\n      // validate: {\n      //   notEmpty: true,\n      //   len: [7, 42],\n      //   msg: \"Password length of 7-42 required.\",\n      // },\n    },\n    role: {\n      type: DataTypes.STRING,\n      allowNull: false,\n    },\n    firstName: {\n      type: DataTypes.STRING,\n      allowNull: false,\n    },\n    lastName: {\n      type: DataTypes.STRING,\n      allowNull: false,\n    },\n    phoneNumber: {\n      type: DataTypes.STRING,\n    },\n    completedProfile: {\n      type: DataTypes.BOOLEAN,\n    },\n  });\n\n  // Delete all user messages\n  User.associate = (models) => {\n    User.hasMany(models.Message, { onDelete: \"CASCADE\" });\n  };\n\n  // Define user by login value\n  User.findByLogin = async (login) => {\n    // Attempt to find user based on username\n    let user = await User.findOne({\n      where: { username: login },\n    });\n\n    // If user not found my username, find by email\n    if (!user) {\n      user = await User.findOne({\n        where: { email: login },\n      });\n    }\n\n    return user;\n  };\n\n  // Create hash of inputted password\n  User.beforeCreate(async (user) => {\n    user.password = await user.generatePasswordHash();\n  });\n\n  // Create hash of inputted password\n  User.beforeUpdate(async (user) => {\n    user.password = await user.generatePasswordHash();\n  });\n\n  // Generate password hash using bcrypt\n  User.prototype.generatePasswordHash = async function () {\n    const saltRounds = 10;\n    return await bcrypt.hash(this.password, saltRounds);\n  };\n\n  // Validate stored user password with user input\n  User.prototype.validatePassword = async function (password) {\n    return await bcrypt.compare(password, this.password);\n  };\n\n  return User;\n};\n\nexport default user;\n"],"file":"user.js"}